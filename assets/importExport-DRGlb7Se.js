import{g as Re,d as be,c as Oe,a as Ae}from"./index-qBwMBaPK.js";var pe={exports:{}};var xe=pe.exports,we;function Le(){return we||(we=1,(function(g,u){((v,o)=>{g.exports=o()})(xe,function v(){var o=typeof self<"u"?self:typeof window<"u"?window:o!==void 0?o:{},_,R=!o.document&&!!o.postMessage,$=o.IS_PAPA_WORKER||!1,j={},K=0,a={};function U(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(e){var r=ee(e);r.chunkSize=parseInt(r.chunkSize),e.step||e.chunk||(r.chunkSize=null),this._handle=new re(r),(this._handle.streamer=this)._config=r}).call(this,t),this.parseChunk=function(e,r){var n=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<n){let f=this._config.newline;f||(s=this._config.quoteChar||'"',f=this._handle.guessLineEndings(e,s)),e=[...e.split(f).slice(n)].join(f)}this.isFirstChunk&&l(this._config.beforeFirstChunk)&&(s=this._config.beforeFirstChunk(e))!==void 0&&(e=s),this.isFirstChunk=!1,this._halted=!1;var n=this._partialLine+e,s=(this._partialLine="",this._handle.parse(n,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(e=s.meta.cursor,n=(this._finished||(this._partialLine=n.substring(e-this._baseIndex),this._baseIndex=e),s&&s.data&&(this._rowCount+=s.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),$)o.postMessage({results:s,workerId:a.WORKER_ID,finished:n});else if(l(this._config.chunk)&&!r){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=s=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),this._completed||!n||!l(this._config.complete)||s&&s.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),n||s&&s.meta.paused||this._nextChunk(),s}this._halted=!0},this._sendError=function(e){l(this._config.error)?this._config.error(e):$&&this._config.error&&o.postMessage({workerId:a.WORKER_ID,error:e,finished:!1})}}function X(t){var e;(t=t||{}).chunkSize||(t.chunkSize=a.RemoteChunkSize),U.call(this,t),this._nextChunk=R?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(r){this._input=r,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),R||(e.onload=N(this._chunkLoaded,this),e.onerror=N(this._chunkError,this)),e.open(this._config.downloadRequestBody?"POST":"GET",this._input,!R),this._config.downloadRequestHeaders){var r,n=this._config.downloadRequestHeaders;for(r in n)e.setRequestHeader(r,n[r])}var s;this._config.chunkSize&&(s=this._start+this._config.chunkSize-1,e.setRequestHeader("Range","bytes="+this._start+"-"+s));try{e.send(this._config.downloadRequestBody)}catch(f){this._chunkError(f.message)}R&&e.status===0&&this._chunkError()}},this._chunkLoaded=function(){e.readyState===4&&(e.status<200||400<=e.status?this._chunkError():(this._start+=this._config.chunkSize||e.responseText.length,this._finished=!this._config.chunkSize||this._start>=(r=>(r=r.getResponseHeader("Content-Range"))!==null?parseInt(r.substring(r.lastIndexOf("/")+1)):-1)(e),this.parseChunk(e.responseText)))},this._chunkError=function(r){r=e.statusText||r,this._sendError(new Error(r))}}function J(t){(t=t||{}).chunkSize||(t.chunkSize=a.LocalChunkSize),U.call(this,t);var e,r,n=typeof FileReader<"u";this.stream=function(s){this._input=s,r=s.slice||s.webkitSlice||s.mozSlice,n?((e=new FileReader).onload=N(this._chunkLoaded,this),e.onerror=N(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var s=this._input,f=(this._config.chunkSize&&(f=Math.min(this._start+this._config.chunkSize,this._input.size),s=r.call(s,this._start,f)),e.readAsText(s,this._config.encoding));n||this._chunkLoaded({target:{result:f}})},this._chunkLoaded=function(s){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(s.target.result)},this._chunkError=function(){this._sendError(e.error)}}function G(t){var e;U.call(this,t=t||{}),this.stream=function(r){return e=r,this._nextChunk()},this._nextChunk=function(){var r,n;if(!this._finished)return r=this._config.chunkSize,e=r?(n=e.substring(0,r),e.substring(r)):(n=e,""),this._finished=!e,this.parseChunk(n)}}function k(t){U.call(this,t=t||{});var e=[],r=!0,n=!1;this.pause=function(){U.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){U.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(s){this._input=s,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){n&&e.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),e.length?this.parseChunk(e.shift()):r=!0},this._streamData=N(function(s){try{e.push(typeof s=="string"?s:s.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(e.shift()))}catch(f){this._streamError(f)}},this),this._streamError=N(function(s){this._streamCleanUp(),this._sendError(s)},this),this._streamEnd=N(function(){this._streamCleanUp(),n=!0,this._streamData("")},this),this._streamCleanUp=N(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function re(t){var e,r,n,s,f=Math.pow(2,53),q=-f,V=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,Y=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,m=this,I=0,c=0,H=!1,p=!1,w=[],i={data:[],errors:[],meta:{}};function M(b){return t.skipEmptyLines==="greedy"?b.join("").trim()==="":b.length===1&&b[0].length===0}function P(){if(i&&n&&(te("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),n=!1),t.skipEmptyLines&&(i.data=i.data.filter(function(d){return!M(d)})),W()){let d=function(D,B){l(t.transformHeader)&&(D=t.transformHeader(D,B)),w.push(D)};if(i)if(Array.isArray(i.data[0])){for(var b=0;W()&&b<i.data.length;b++)i.data[b].forEach(d);i.data.splice(0,1)}else i.data.forEach(d)}function S(d,D){for(var B=t.header?{}:[],O=0;O<d.length;O++){var A=O,E=d[O],E=((se,y)=>(L=>(t.dynamicTypingFunction&&t.dynamicTyping[L]===void 0&&(t.dynamicTyping[L]=t.dynamicTypingFunction(L)),(t.dynamicTyping[L]||t.dynamicTyping)===!0))(se)?y==="true"||y==="TRUE"||y!=="false"&&y!=="FALSE"&&((L=>{if(V.test(L)&&(L=parseFloat(L),q<L&&L<f))return 1})(y)?parseFloat(y):Y.test(y)?new Date(y):y===""?null:y):y)(A=t.header?O>=w.length?"__parsed_extra":w[O]:A,E=t.transform?t.transform(E,A):E);A==="__parsed_extra"?(B[A]=B[A]||[],B[A].push(E)):B[A]=E}return t.header&&(O>w.length?te("FieldMismatch","TooManyFields","Too many fields: expected "+w.length+" fields but parsed "+O,c+D):O<w.length&&te("FieldMismatch","TooFewFields","Too few fields: expected "+w.length+" fields but parsed "+O,c+D)),B}var T;i&&(t.header||t.dynamicTyping||t.transform)&&(T=1,!i.data.length||Array.isArray(i.data[0])?(i.data=i.data.map(S),T=i.data.length):i.data=S(i.data,0),t.header&&i.meta&&(i.meta.fields=w),c+=T)}function W(){return t.header&&w.length===0}function te(b,S,T,d){b={type:b,code:S,message:T},d!==void 0&&(b.row=d),i.errors.push(b)}l(t.step)&&(s=t.step,t.step=function(b){i=b,W()?P():(P(),i.data.length!==0&&(I+=b.data.length,t.preview&&I>t.preview?r.abort():(i.data=i.data[0],s(i,m))))}),this.parse=function(b,S,T){var d=t.quoteChar||'"',d=(t.newline||(t.newline=this.guessLineEndings(b,d)),n=!1,t.delimiter?l(t.delimiter)&&(t.delimiter=t.delimiter(b),i.meta.delimiter=t.delimiter):((d=((D,B,O,A,E)=>{var se,y,L,ce;E=E||[",","	","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var de=0;de<E.length;de++){for(var ie,he=E[de],Q=0,ae=0,z=0,Z=(L=void 0,new C({comments:A,delimiter:he,newline:B,preview:10}).parse(D)),ue=0;ue<Z.data.length;ue++)O&&M(Z.data[ue])?z++:(ie=Z.data[ue].length,ae+=ie,L===void 0?L=ie:0<ie&&(Q+=Math.abs(ie-L),L=ie));0<Z.data.length&&(ae/=Z.data.length-z),(y===void 0||Q<=y)&&(ce===void 0||ce<ae)&&1.99<ae&&(y=Q,se=he,ce=ae)}return{successful:!!(t.delimiter=se),bestDelimiter:se}})(b,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess)).successful?t.delimiter=d.bestDelimiter:(n=!0,t.delimiter=a.DefaultDelimiter),i.meta.delimiter=t.delimiter),ee(t));return t.preview&&t.header&&d.preview++,e=b,r=new C(d),i=r.parse(e,S,T),P(),H?{meta:{paused:!0}}:i||{meta:{paused:!1}}},this.paused=function(){return H},this.pause=function(){H=!0,r.abort(),e=l(t.chunk)?"":e.substring(r.getCharIndex())},this.resume=function(){m.streamer._halted?(H=!1,m.streamer.parseChunk(e,!0)):setTimeout(m.resume,3)},this.aborted=function(){return p},this.abort=function(){p=!0,r.abort(),i.meta.aborted=!0,l(t.complete)&&t.complete(i),e=""},this.guessLineEndings=function(D,d){D=D.substring(0,1048576);var d=new RegExp(ne(d)+"([^]*?)"+ne(d),"gm"),T=(D=D.replace(d,"")).split("\r"),d=D.split(`
`),D=1<d.length&&d[0].length<T[0].length;if(T.length===1||D)return`
`;for(var B=0,O=0;O<T.length;O++)T[O][0]===`
`&&B++;return B>=T.length/2?`\r
`:"\r"}}function ne(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function C(t){var e=(t=t||{}).delimiter,r=t.newline,n=t.comments,s=t.step,f=t.preview,q=t.fastMode,V=null,Y=!1,m=t.quoteChar==null?'"':t.quoteChar,I=m;if(t.escapeChar!==void 0&&(I=t.escapeChar),(typeof e!="string"||-1<a.BAD_DELIMITERS.indexOf(e))&&(e=","),n===e)throw new Error("Comment character same as delimiter");n===!0?n="#":(typeof n!="string"||-1<a.BAD_DELIMITERS.indexOf(n))&&(n=!1),r!==`
`&&r!=="\r"&&r!==`\r
`&&(r=`
`);var c=0,H=!1;this.parse=function(p,w,i){if(typeof p!="string")throw new Error("Input must be a string");var M=p.length,P=e.length,W=r.length,te=n.length,b=l(s),S=[],T=[],d=[],D=c=0;if(!p)return Q();if(q||q!==!1&&p.indexOf(m)===-1){for(var B=p.split(r),O=0;O<B.length;O++){if(d=B[O],c+=d.length,O!==B.length-1)c+=r.length;else if(i)return Q();if(!n||d.substring(0,te)!==n){if(b){if(S=[],ce(d.split(e)),ae(),H)return Q()}else ce(d.split(e));if(f&&f<=O)return S=S.slice(0,f),Q(!0)}}return Q()}for(var A=p.indexOf(e,c),E=p.indexOf(r,c),se=new RegExp(ne(I)+ne(m),"g"),y=p.indexOf(m,c);;)if(p[c]===m)for(y=c,c++;;){if((y=p.indexOf(m,y+1))===-1)return i||T.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:S.length,index:c}),ie();if(y===M-1)return ie(p.substring(c,y).replace(se,m));if(m===I&&p[y+1]===I)y++;else if(m===I||y===0||p[y-1]!==I){A!==-1&&A<y+1&&(A=p.indexOf(e,y+1));var L=de((E=E!==-1&&E<y+1?p.indexOf(r,y+1):E)===-1?A:Math.min(A,E));if(p.substr(y+1+L,P)===e){d.push(p.substring(c,y).replace(se,m)),p[c=y+1+L+P]!==m&&(y=p.indexOf(m,c)),A=p.indexOf(e,c),E=p.indexOf(r,c);break}if(L=de(E),p.substring(y+1+L,y+1+L+W)===r){if(d.push(p.substring(c,y).replace(se,m)),he(y+1+L+W),A=p.indexOf(e,c),y=p.indexOf(m,c),b&&(ae(),H))return Q();if(f&&S.length>=f)return Q(!0);break}T.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:S.length,index:c}),y++}}else if(n&&d.length===0&&p.substring(c,c+te)===n){if(E===-1)return Q();c=E+W,E=p.indexOf(r,c),A=p.indexOf(e,c)}else if(A!==-1&&(A<E||E===-1))d.push(p.substring(c,A)),c=A+P,A=p.indexOf(e,c);else{if(E===-1)break;if(d.push(p.substring(c,E)),he(E+W),b&&(ae(),H))return Q();if(f&&S.length>=f)return Q(!0)}return ie();function ce(z){S.push(z),D=c}function de(z){var Z=0;return Z=z!==-1&&(z=p.substring(y+1,z))&&z.trim()===""?z.length:Z}function ie(z){return i||(z===void 0&&(z=p.substring(c)),d.push(z),c=M,ce(d),b&&ae()),Q()}function he(z){c=z,ce(d),d=[],E=p.indexOf(r,c)}function Q(z){if(t.header&&!w&&S.length&&!Y){var Z=S[0],ue=Object.create(null),ye=new Set(Z);let ge=!1;for(let le=0;le<Z.length;le++){let oe=Z[le];if(ue[oe=l(t.transformHeader)?t.transformHeader(oe,le):oe]){let fe,_e=ue[oe];for(;fe=oe+"_"+_e,_e++,ye.has(fe););ye.add(fe),Z[le]=fe,ue[oe]++,ge=!0,(V=V===null?{}:V)[fe]=oe}else ue[oe]=1,Z[le]=oe;ye.add(oe)}ge&&console.warn("Duplicate headers found and renamed."),Y=!0}return{data:S,errors:T,meta:{delimiter:e,linebreak:r,aborted:H,truncated:!!z,cursor:D+(w||0),renamedHeaders:V}}}function ae(){s(Q()),S=[],T=[]}},this.abort=function(){H=!0},this.getCharIndex=function(){return c}}function F(t){var e=t.data,r=j[e.workerId],n=!1;if(e.error)r.userError(e.error,e.file);else if(e.results&&e.results.data){var s={abort:function(){n=!0,h(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:x,resume:x};if(l(r.userStep)){for(var f=0;f<e.results.data.length&&(r.userStep({data:e.results.data[f],errors:e.results.errors,meta:e.results.meta},s),!n);f++);delete e.results}else l(r.userChunk)&&(r.userChunk(e.results,s,e.file),delete e.results)}e.finished&&!n&&h(e.workerId,e.results)}function h(t,e){var r=j[t];l(r.userComplete)&&r.userComplete(e),r.terminate(),delete j[t]}function x(){throw new Error("Not implemented.")}function ee(t){if(typeof t!="object"||t===null)return t;var e,r=Array.isArray(t)?[]:{};for(e in t)r[e]=ee(t[e]);return r}function N(t,e){return function(){t.apply(e,arguments)}}function l(t){return typeof t=="function"}return a.parse=function(t,e){var r=(e=e||{}).dynamicTyping||!1;if(l(r)&&(e.dynamicTypingFunction=r,r={}),e.dynamicTyping=r,e.transform=!!l(e.transform)&&e.transform,!e.worker||!a.WORKERS_SUPPORTED)return r=null,a.NODE_STREAM_INPUT,typeof t=="string"?(t=(n=>n.charCodeAt(0)!==65279?n:n.slice(1))(t),r=new(e.download?X:G)(e)):t.readable===!0&&l(t.read)&&l(t.on)?r=new k(e):(o.File&&t instanceof File||t instanceof Object)&&(r=new J(e)),r.stream(t);(r=(()=>{var n;return!!a.WORKERS_SUPPORTED&&(n=(()=>{var s=o.URL||o.webkitURL||null,f=v.toString();return a.BLOB_URL||(a.BLOB_URL=s.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",f,")();"],{type:"text/javascript"})))})(),(n=new o.Worker(n)).onmessage=F,n.id=K++,j[n.id]=n)})()).userStep=e.step,r.userChunk=e.chunk,r.userComplete=e.complete,r.userError=e.error,e.step=l(e.step),e.chunk=l(e.chunk),e.complete=l(e.complete),e.error=l(e.error),delete e.worker,r.postMessage({input:t,config:e,workerId:r.id})},a.unparse=function(t,e){var r=!1,n=!0,s=",",f=`\r
`,q='"',V=q+q,Y=!1,m=null,I=!1,c=((()=>{if(typeof e=="object"){if(typeof e.delimiter!="string"||a.BAD_DELIMITERS.filter(function(w){return e.delimiter.indexOf(w)!==-1}).length||(s=e.delimiter),typeof e.quotes!="boolean"&&typeof e.quotes!="function"&&!Array.isArray(e.quotes)||(r=e.quotes),typeof e.skipEmptyLines!="boolean"&&typeof e.skipEmptyLines!="string"||(Y=e.skipEmptyLines),typeof e.newline=="string"&&(f=e.newline),typeof e.quoteChar=="string"&&(q=e.quoteChar),typeof e.header=="boolean"&&(n=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");m=e.columns}e.escapeChar!==void 0&&(V=e.escapeChar+q),e.escapeFormulae instanceof RegExp?I=e.escapeFormulae:typeof e.escapeFormulae=="boolean"&&e.escapeFormulae&&(I=/^[=+\-@\t\r].*$/)}})(),new RegExp(ne(q),"g"));if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return H(null,t,Y);if(typeof t[0]=="object")return H(m||Object.keys(t[0]),t,Y)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||m),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),H(t.fields||[],t.data||[],Y);throw new Error("Unable to serialize unrecognized input");function H(w,i,M){var P="",W=(typeof w=="string"&&(w=JSON.parse(w)),typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(w)&&0<w.length),te=!Array.isArray(i[0]);if(W&&n){for(var b=0;b<w.length;b++)0<b&&(P+=s),P+=p(w[b],b);0<i.length&&(P+=f)}for(var S=0;S<i.length;S++){var T=(W?w:i[S]).length,d=!1,D=W?Object.keys(i[S]).length===0:i[S].length===0;if(M&&!W&&(d=M==="greedy"?i[S].join("").trim()==="":i[S].length===1&&i[S][0].length===0),M==="greedy"&&W){for(var B=[],O=0;O<T;O++){var A=te?w[O]:O;B.push(i[S][A])}d=B.join("").trim()===""}if(!d){for(var E=0;E<T;E++){0<E&&!D&&(P+=s);var se=W&&te?w[E]:E;P+=p(i[S][se],E)}S<i.length-1&&(!M||0<T&&!D)&&(P+=f)}}return P}function p(w,i){var M,P;return w==null?"":w.constructor===Date?JSON.stringify(w).slice(1,25):(P=!1,I&&typeof w=="string"&&I.test(w)&&(w="'"+w,P=!0),M=w.toString().replace(c,V),(P=P||r===!0||typeof r=="function"&&r(w,i)||Array.isArray(r)&&r[i]||((W,te)=>{for(var b=0;b<te.length;b++)if(-1<W.indexOf(te[b]))return!0;return!1})(M,a.BAD_DELIMITERS)||-1<M.indexOf(s)||M.charAt(0)===" "||M.charAt(M.length-1)===" ")?q+M+q:M)}},a.RECORD_SEP="",a.UNIT_SEP="",a.BYTE_ORDER_MARK="\uFEFF",a.BAD_DELIMITERS=["\r",`
`,'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!R&&!!o.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=C,a.ParserHandle=re,a.NetworkStreamer=X,a.FileStreamer=J,a.StringStreamer=G,a.ReadableStreamStreamer=k,o.jQuery&&((_=o.jQuery).fn.parse=function(t){var e=t.config||{},r=[];return this.each(function(f){if(!(_(this).prop("tagName").toUpperCase()==="INPUT"&&_(this).attr("type").toLowerCase()==="file"&&o.FileReader)||!this.files||this.files.length===0)return!0;for(var q=0;q<this.files.length;q++)r.push({file:this.files[q],inputElem:this,instanceConfig:_.extend({},e)})}),n(),this;function n(){if(r.length===0)l(t.complete)&&t.complete();else{var f,q,V,Y,m=r[0];if(l(t.before)){var I=t.before(m.file,m.inputElem);if(typeof I=="object"){if(I.action==="abort")return f="AbortError",q=m.file,V=m.inputElem,Y=I.reason,void(l(t.error)&&t.error({name:f},q,V,Y));if(I.action==="skip")return void s();typeof I.config=="object"&&(m.instanceConfig=_.extend(m.instanceConfig,I.config))}else if(I==="skip")return void s()}var c=m.instanceConfig.complete;m.instanceConfig.complete=function(H){l(c)&&c(H,m.file,m.inputElem),s()},a.parse(m.file,m.instanceConfig)}}function s(){r.splice(0,1),n()}}),$&&(o.onmessage=function(t){t=t.data,a.WORKER_ID===void 0&&t&&(a.WORKER_ID=t.workerId),typeof t.input=="string"?o.postMessage({workerId:a.WORKER_ID,results:a.parse(t.input,t.config),finished:!0}):(o.File&&t.input instanceof File||t.input instanceof Object)&&(t=a.parse(t.input,t.config))&&o.postMessage({workerId:a.WORKER_ID,results:t,finished:!0})}),(X.prototype=Object.create(U.prototype)).constructor=X,(J.prototype=Object.create(U.prototype)).constructor=J,(G.prototype=Object.create(G.prototype)).constructor=G,(k.prototype=Object.create(U.prototype)).constructor=k,a})})(pe)),pe.exports}var Ie=Le();const Ee=Re(Ie);function ke(g){if(g.includes("T")||g.match(/^\d{4}-\d{2}-\d{2}/))return new Date(g);const u=g.split(new RegExp("[-/]"));if(u.length===3){const v=parseInt(u[0],10)-1,o=parseInt(u[1],10),_=parseInt(u[2],10);return new Date(_,v,o)}return new Date(g)}function me(g){return g?parseFloat(g.replace(/[$,]/g,"")):0}function ve(g){return g?parseFloat(g.replace(/[,\s]/g,"")):0}function Se(g,u){const v=g.toUpperCase(),o=(u||"").toLowerCase();return o.includes("option")||v.includes("CALL")||v.includes("PUT")?"Option":o.includes("etf")||v.includes("ETF")?"ETF":o.includes("future")?"Future":o.includes("crypto")||o.includes("bitcoin")||o.includes("ethereum")?"Crypto":o.includes("forex")||o.includes("fx")?"Forex":"Stock"}function Te(g){return/^\s*[A-Z]+\s+\d{6}[CP]\d+/.test(g.trim())}const De={name:"wealthsimple",detect:g=>{const u=g.map(v=>v.toLowerCase().trim());return(u.includes("transaction_date")||u.some(v=>v.includes("transaction_date")))&&u.includes("activity_sub_type")&&u.includes("quantity")&&u.includes("unit_price")},parse:g=>{const u={};Object.keys(g).forEach(l=>{u[l.toLowerCase().trim()]=g[l]});const v=u.transaction_date;if(!v)throw new Error("Missing transaction_date");const o=u.activity_type?.trim().toUpperCase();if(o&&o!=="TRADE")return null;const _=u.activity_sub_type?.trim().toUpperCase();if(!_||_!=="BUY"&&_!=="SELL")throw new Error(`Invalid activity_sub_type: ${_||"empty"} (must be BUY or SELL)`);const R=_==="SELL"?"Sell":"Buy",$=u["underlying symbol"]?.trim(),j=u.symbol?.trim(),K=($||j||"").toUpperCase();if(!K)throw new Error("Missing symbol and underlying symbol");const a=u.quantity?.trim();if(!a)throw new Error("Missing quantity");const U=Math.abs(ve(a));if(U===0||isNaN(U))throw new Error(`Invalid quantity: ${a}`);const X=u.unit_price?.trim();if(!X)throw new Error("Missing unit_price");const J=me(X);if(isNaN(J)||J<0)throw new Error(`Invalid unit_price: ${X}`);const G=u.commission?.trim(),k=G?me(G):0,re=u.name?.trim(),ne=u.currency?.trim(),F=Te(j||"")?"Option":Se(K,re),h=[];re&&h.push(re),j&&j!==K&&h.push(`Full symbol: ${j}`),ne&&ne!=="USD"&&h.push(`Currency: ${ne}`),o&&o!=="TRADE"&&h.push(`Activity: ${o}`);const x=h.length>0?`Imported from Wealthsimple - ${h.join(", ")}`:"Imported from Wealthsimple",ee=ke(v),N=new Date;return{date:ee,symbol:K,type:F,side:R,entryPrice:J,quantity:U,fees:k,status:"Closed",notes:x,createdAt:N,updatedAt:N}}},Fe={name:"generic",detect:()=>!0,parse:g=>{const u={};Object.keys(g).forEach(k=>{u[k.toLowerCase()]=g[k]});const v=Object.keys(u).find(k=>k.includes("date")),o=Object.keys(u).find(k=>k.includes("symbol")||k.includes("ticker")||k.includes("stock")),_=Object.keys(u).find(k=>k.includes("side")||k.includes("type")||k.includes("action")),R=Object.keys(u).find(k=>k.includes("quantity")||k.includes("qty")||k.includes("shares")),$=Object.keys(u).find(k=>k.includes("price")||k.includes("entry"));if(!v||!o||!R)return null;const j=u[o]?.trim().toUpperCase();if(!j)return null;const K=_?u[_]?.toLowerCase():"",a=K.includes("sell")||K.includes("short")?"Sell":"Buy",U=ve(u[R]),X=$?me(u[$]):0;if(U===0)return null;const J=ke(u[v]),G=new Date;return{date:J,symbol:j,type:Se(j),side:a,entryPrice:X,quantity:U,status:"Closed",notes:"Imported from CSV",createdAt:G,updatedAt:G}}},Ce=()=>[De,Fe],qe=g=>{const u=Ce();for(const v of u)if(v.detect(g))return v.name;return"generic"},je=(g,u="trading-journal.csv")=>{const v=Ee.unparse(g.map(R=>({...R,date:R.date.toISOString(),createdAt:R.createdAt.toISOString(),updatedAt:R.updatedAt.toISOString()}))),o=new Blob([v],{type:"text/csv;charset=utf-8;"}),_=document.createElement("a");_.href=URL.createObjectURL(o),_.setAttribute("download",u),document.body.appendChild(_),_.click(),document.body.removeChild(_)},Ue=(g,u="trading-journal.json")=>{const v=JSON.stringify(g,null,2),o=new Blob([v],{type:"application/json"}),_=document.createElement("a");_.href=URL.createObjectURL(o),_.setAttribute("download",u),document.body.appendChild(_),_.click(),document.body.removeChild(_)},Me=async g=>new Promise((u,v)=>{const o=new FileReader;o.onload=async _=>{try{const R=_.target?.result,$=JSON.parse(R);if(Array.isArray($)){const j=$.map(K=>({...K,date:new Date(K.date),createdAt:new Date(K.createdAt),updatedAt:new Date(K.updatedAt)}));await be.trades.bulkPut(j),u()}else v("Invalid format")}catch(R){v(R)}},o.readAsText(g)}),Be=async(g,u="auto",v="trading")=>new Promise((o,_)=>{Ee.parse(g,{header:!0,skipEmptyLines:!0,transformHeader:R=>R.trim(),transform:R=>R?.trim(),complete:async R=>{try{const $=R.data;if($.length===0){_(new Error("CSV file is empty or has no valid rows"));return}let j=u;if(u==="auto"){const C=Object.keys($[0]);j=qe(C)}const K=Ce(),a=K.find(C=>C.name===j)||K.find(C=>C.name==="generic");if(!a){_(new Error("No suitable broker adapter found"));return}const U=$.filter(C=>{const F=Object.keys(C),h=F.some(N=>{const l=C[N];return l&&typeof l=="string"&&l.trim().length>0}),x=F.length>0?(C[F[0]]||"").toString().toLowerCase():"",ee=x.includes("as of")||x.includes("generated");return h&&!ee}),X=[],J=[];let G=0;for(let C=0;C<U.length;C++){const F=U[C];try{const h=a.parse(F);if(h)if(h.date&&h.symbol&&h.entryPrice&&h.quantity){const x={};Object.keys(F).forEach(e=>{x[e.toLowerCase().trim()]=F[e]});const ee=(x.symbol?.trim()||h.symbol).toUpperCase(),N=(x.direction?.trim()||"LONG").toUpperCase(),l=h.side==="Sell"?"SELL":"BUY",t=N==="LONG"?l==="BUY":l==="SELL";X.push({rowIndex:C+2,date:h.date instanceof Date?h.date:new Date(h.date),symbol:h.symbol,fullSymbol:ee,direction:N,action:l,isEntry:t,price:h.entryPrice,quantity:h.quantity,fees:h.fees||0,type:h.type||"Stock",notes:h.notes||""})}else{G++;const x=[];h.date||x.push("date"),h.symbol||x.push("symbol"),h.entryPrice||x.push("entryPrice"),h.quantity||x.push("quantity"),J.push(`Row ${C+2}: Missing required fields: ${x.join(", ")}`)}}catch(h){G++;const x=h instanceof Error?h.message:"Unknown error";J.push(`Row ${C+2}: ${x}`)}}const k=[],re=new Map;X.forEach(C=>{const F=C.fullSymbol;re.has(F)||re.set(F,[]),re.get(F).push(C)}),re.forEach(C=>{C.sort((e,r)=>e.date.getTime()-r.date.getTime());const F=[],h=[];C.forEach(e=>{e.isEntry?F.push(e):h.push(e)});const x=C[0],ee=x.symbol,N=x.fullSymbol,l=x.direction==="SHORT",t=x.type==="Option"?N:ee;for(;F.length>0&&h.length>0;){const e=F[0],r=h[0],n=Math.min(e.quantity,r.quantity),s=new Date,f=l?"Sell":"Buy",q=Oe(e.price,r.price,n,f),V=Ae(e.price,r.price,f),Y=(e.fees||0)+(r.fees||0),m={accountId:v,date:e.date,symbol:t,type:e.type,side:f,entryPrice:e.price,exitPrice:r.price,exitDate:r.date,quantity:n,status:"Closed",pnl:q-Y,pnlPercentage:V,fees:Y,notes:`Matched trade: ${e.notes||""} â†’ ${r.notes||""}`.trim()||"Imported from Wealthsimple",createdAt:s,updatedAt:s};k.push(m),e.quantity-=n,r.quantity-=n,e.quantity===0&&F.shift(),r.quantity===0&&h.shift()}F.forEach(e=>{if(e.quantity>0){const r=new Date,n=l?"Sell":"Buy",s={accountId:v,date:e.date,symbol:t,type:e.type,side:n,entryPrice:e.price,quantity:e.quantity,status:"Open",fees:e.fees||0,notes:e.notes||`Imported from Wealthsimple (open ${l?"short":"long"} position)`,createdAt:r,updatedAt:r};k.push(s)}}),h.forEach(e=>{if(e.quantity>0){const r=new Date,n=l?"Sell":"Buy",s={accountId:v,date:e.date,symbol:t,type:e.type,side:n,entryPrice:e.price,quantity:e.quantity,status:"Open",fees:e.fees||0,notes:`${e.notes||"Imported from Wealthsimple"} - WARNING: Entry transaction not found. This was an exit transaction - please update entry price and close the trade when ready.`,createdAt:r,updatedAt:r};k.push(s),J.push(`Row ${e.rowIndex}: Exit transaction without matching entry for ${ee} - Created as OPEN trade (entry price needs update)`)}})});const ne=k.length;k.length>0&&await be.trades.bulkAdd(k),o({success:ne,failed:G,errors:J.slice(0,10)})}catch($){_($)}},error:R=>{_(new Error(`CSV parsing error: ${R.message}`))}})});export{je as exportToCsv,Ue as exportToJson,Be as importFromCsv,Me as importFromJson};
